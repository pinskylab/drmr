<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Examples • drmr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="examples_files/libs/quarto-html/popper.min.js"></script><script src="examples_files/libs/quarto-html/tippy.umd.min.js"></script><link href="examples_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="examples_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">drmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.24</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/examples.html">Examples</a></li>
    <li><a class="dropdown-item" href="../articles/get-started.html">Get Started</a></li>
    <li><a class="dropdown-item" href="../articles/theory.html">Theoretical Background</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pinskylab/drmr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Examples</h1>

      <p class="author">Lucas da Cunha Godoy</p>


      <small class="dont-index">Source: <a href="https://github.com/pinskylab/drmr/blob/main/vignettes/examples.qmd" class="external-link"><code>vignettes/examples.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <hr>
<section class="level2 unnumbered"><h2 class="unnumbered" id="tl-dr">TL; DR<a class="anchor" aria-label="anchor" href="#tl-dr"></a>
</h2>
<p>This document demonstrates the functionalities of the <code>drmr</code> R package for fitting Dynamic Range and Species Distribution Models (DRMs and SDMs, respectively) using pre-compiled <code>Stan</code> models.</p>
<p>We’ll explore increasingly complex models, showcasing the package’s capabilities with the help of five additional <code>R</code> packages:</p>
<ul>
<li>
<code>sf</code>: for spatial data manipulation and visualization</li>
<li>
<code>ggplot2</code>: for creating graphs</li>
<li>
<code>bayesplot</code>: for visualizing MCMC outputs</li>
<li>
<code>dplyr</code>: for data wrangling</li>
</ul></section><section class="level2"><h2 id="sec-drmr">Installing the <code>drmr</code> package<a class="anchor" aria-label="anchor" href="#sec-drmr"></a>
</h2>
<p>The <code>drmr</code> package provides pre-compiled <code>cmdstanr</code> <span class="citation" data-cites="gabry2024cmdstanr">(<a href="#ref-gabry2024cmdstanr" role="doc-biblioref">Gabry et al. 2024</a>)</span> models powered by the <code>instantiate</code> package <span class="citation" data-cites="landau2024instantiate">(<a href="#ref-landau2024instantiate" role="doc-biblioref">Landau 2024</a>)</span>. These pre-compiled models allow us to make inferences about the DRM (and SDM) using <code>cmdstan</code> algorithms, such as the HMC NUTS Sampler.</p>
<p>The package is not on CRAN yet. To install the version hosted on GitHub, run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"pinskylab/drmr"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Finally, the code below loads the packages necessary to reproduce the examples in this document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pinskylab.github.io/drmr/">drmr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co">## "mapping"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co">## graphs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span> <span class="co">## and more graphs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="sec-data">Data<a class="anchor" aria-label="anchor" href="#sec-data"></a>
</h2>
<p>This example uses Summer Flounder data from Alexa’s project. We begin by loading the dataset and calculating a density variable (raw counts divided by patch area):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## loads the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sum_fl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## computing density</span></span>
<span><span class="va">sum_fl</span> <span class="op">&lt;-</span> <span class="va">sum_fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dens <span class="op">=</span> <span class="va">y</span> <span class="op">/</span> <span class="va">area_km2</span>,</span>
<span>         .before <span class="op">=</span> <span class="va">y</span><span class="op">)</span></span></code></pre></div>
</div>
<p>A quick exploration of the data reveals the following:</p>
<ul>
<li>Surface salinity (ssalin) and bottom salinity (bsalin) have missing values (around 30% missing for each).</li>
<li>At least 25% of the density (<code>dens</code>) values are zero.</li>
</ul>
<p>Finally, we split the data, reserving the last five years for evaluating predictions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 5 years-ahead predictions</span></span>
<span><span class="va">first_year_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sum_fl</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="va">first_id_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">first_year_forecast</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sum_fl</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">## splitting data</span></span>
<span><span class="va">dat_test</span> <span class="op">&lt;-</span> <span class="va">sum_fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">first_year_forecast</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_train</span> <span class="op">&lt;-</span> <span class="va">sum_fl</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&lt;</span> <span class="va">first_year_forecast</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level2"><h2 id="loading-pre-compiled-models">Loading pre-compiled models<a class="anchor" aria-label="anchor" href="#loading-pre-compiled-models"></a>
</h2>
<p>To load the pre-compiled SDM described <a href="https://pinskylab.github.io/drmr/articles/theory.html#sec-sdm">here</a>, run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sdm_compiled</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">instantiate</span><span class="fu">::</span><span class="fu"><a href="https://wlandau.github.io/instantiate/reference/stan_package_model.html" class="external-link">stan_package_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"sdm"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Similarly, to load the pre-compiled DRM, we run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drm_compiled</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">instantiate</span><span class="fu">::</span><span class="fu"><a href="https://wlandau.github.io/instantiate/reference/stan_package_model.html" class="external-link">stan_package_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"drm"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>These models also have associated pre-compiled <code>forecast</code> objects. They can be loaded as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">instantiate</span><span class="fu">::</span><span class="fu"><a href="https://wlandau.github.io/instantiate/reference/stan_package_model.html" class="external-link">stan_package_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"forecast_sdm"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forecast_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">instantiate</span><span class="fu">::</span><span class="fu"><a href="https://wlandau.github.io/instantiate/reference/stan_package_model.html" class="external-link">stan_package_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"forecast"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Lastly, to calculate density-weighted centroids, the following pre-compiled object is available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroids_compiled</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">instantiate</span><span class="fu">::</span><span class="fu"><a href="https://wlandau.github.io/instantiate/reference/stan_package_model.html" class="external-link">stan_package_model</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"centroid"</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>All of the pre-compiled models are of class <code>CmdStanModel</code> and they work just as any other compiled <code>cmdstanr</code> <a href="https://mc-stan.org/cmdstanr/reference/CmdStanModel.html#model-fitting" class="external-link">model</a>.</p>
</section><section class="level2"><h2 id="preparing-data-fitting-models">Preparing data &amp; fitting models<a class="anchor" aria-label="anchor" href="#preparing-data-fitting-models"></a>
</h2>
<p>Currently, in addition to the pre-compiled models, the <code>drmr</code> package has three functions. They are the following:</p>
<ul>
<li><p><code>make_data</code>: creates a <code>list</code> that will be used as the input for a <code>drm</code> model (see <code><a href="../reference/make_data.html">?drmr::make_data</a></code> for all the function arguments).</p></li>
<li><p><code>default_priors</code> is a function that takes no arguments and return the default hyperparameters for the priors from the model;</p></li>
<li><p><code>default_toggles</code> is another function taking no arguments. This one return the default “toggles” for the <code>drm</code> the model. The toggles turn features of the model (e.g., movement) on and off.</p></li>
</ul>
<p>Let us start fitting the simplest DRM available in the package. The first step, is always to use the <code>make_data</code> function to create the input for the <code>cmdstan</code> model. This function takes a set of inputs, and turn them into the appropriate format for our code. Below, we only provide three inputs for the function:</p>
<ul>
<li><p><code>y</code> the vector of densities</p></li>
<li><p><code>time</code> the vector of time points</p></li>
<li><p><code>site</code> the vector of patches/sites.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_data.html">make_data</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">dens</span>, <span class="co">## response variable: density</span></span>
<span>            time <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span>, <span class="co">## vector of time points</span></span>
<span>            site <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">patch</span>, <span class="co">## vector of patches</span></span>
<span>            n_ages <span class="op">=</span> <span class="fl">8</span>, <span class="co">## number of age groups</span></span>
<span>            .toggles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## checking the elements of the list:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
</div>
<p>The output of <code>names(data)</code> displays the “names” of the elements of the output list from the <code>make_data</code>. Some of these elements are inferred from <code>y</code>, <code>time</code>, and <code>site</code> and others take default values. For example:</p>
<ul>
<li><p><code>n_ages</code> is the total number of (unobserved) ages <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>. If not provided, <code>n_ages</code> is taken to be 1.</p></li>
<li><p><code>f</code> represents <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mrow><mi>a</mi><mo>,</mo><mi>t</mi></mrow></msub><annotation encoding="application/x-tex">f_{a, t}</annotation></semantics></math> from the survival equation described <a href="https://pinskylab.github.io/drmr/articles/theory2.html#sec-surv">here</a>. Its default value is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mrow><mi>a</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">f_{a, t} = 0</annotation></semantics></math> for every age and time point.</p></li>
<li><p><code>m</code> is the mortality rate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math> also from the survival equation mentioned in the last item. Its default value is 0.25 <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;taken from Alexa’s code.&lt;/p&gt;"><sup>1</sup></a>.</p></li>
<li><p><code>X_t</code> is a matrix such that its <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th row is as in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>𝐱</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{x}^{(1)}_{t, i}</annotation></semantics></math> in <a href="https://pinskylab.github.io/drmr/articles/theory.html#eq-linpreds">Equation 2</a>. While <code>K_t</code> represents the number of columns in <code>X_t</code>. If no input is given, <code>X_t</code> has a single column and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mi>T</mi><mo>⋅</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">N = T \cdot P</annotation></semantics></math> rows.</p></li>
<li><p><code>X_r</code> is a matrix such that its <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th row is as in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>𝐱</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>r</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{x}^{(r)}_{t, i}</annotation></semantics></math> in <strong>?@eq-lmrec</strong>. While <code>K_r</code> represents the number of columns in <code>X_r</code>. If no input is given, <code>X_r</code> has a single column and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mi>T</mi><mo>⋅</mo><mi>P</mi></mrow><annotation encoding="application/x-tex">N = T \cdot P</annotation></semantics></math> rows.</p></li>
<li><p><code>X_m</code> is a matrix such that its <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th row is as in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>𝐱</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>m</mi><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><annotation encoding="application/x-tex">\mathbf{x}^{(m)}_{t, i}</annotation></semantics></math> in <strong>?@eq-lmsurv</strong>. While <code>K_m</code> represents the number of columns in <code>X_m</code>. If no input is given, <code>X_m</code> is “empty”.</p></li>
<li><p><code>adj_mat</code> is the adjacency matrix used to encode movement as <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐀</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math>, while <code>age_at_maturity</code> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>0</mn></msub><annotation encoding="application/x-tex">a_0</annotation></semantics></math> in <a href="https://pinskylab.github.io/drmr/articles/theory.html#sec-movement">this document</a>.</p></li>
<li><p><code>selectivity_at_age</code> is a vector of length <code>n_ages</code> informing the selectivity at each age group.</p></li>
</ul>
<p>The remaining elements are toggles and prior hyperparameters that will be described later on. The prior hyperparameters start with <code>pr_</code>.</p>
<p>The toggle called <code>likelihood</code> takes four possible values. When <code>likelihood = 0</code> (default), the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>⋅</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\cdot)</annotation></semantics></math> function in <a href="https://pinskylab.github.io/drmr/articles/theory2.html#eq-za_dens">Equation 1</a> (in the Theoretical Background vignette) is taken to be a Log-Normal density with the usual parametrization. When <code>likelihood = 1</code>, we still get a Log-Lormal density, but parametrized in terms of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>. For <code>likelihood</code> equal to 2 or 3, we get a Gamma or a Log-Logistic distribution, respectively. The last two densities are also parametrized in terms of their mean. For more details, see <span class="citation" data-cites="ye2021comparisons">Ye et al. (<a href="#ref-ye2021comparisons" role="doc-biblioref">2021</a>)</span>.</p>
<p>Finally, below we obtain samples from the model associated with the data list we just created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">drm_1</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This model has only three parameters:</p>
<ul>
<li><p><code>phi</code>: this parameter has no practical interpretation;</p></li>
<li><p>In this simpler model, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>=</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta_{t, i} = \theta</annotation></semantics></math> for every <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>. Then, <code>coef_t = \mathrm{logit}(\theta)</code> is the logit of the probability of observing a zero density.</p></li>
<li><p>In this simpler model, <code>coef_r</code> is the log of the overall recruitment per unit of area.</p></li>
</ul>
<p>We can introduce a AR(1) temporal random effect for recruitment by turning the <code>time_ar</code> toggle on and re-running the model. See below the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_data.html">make_data</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">dens</span>, <span class="co">## response variable: density</span></span>
<span>            time <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span>, <span class="co">## vector of time points</span></span>
<span>            site <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">patch</span>, <span class="co">## vector of patches</span></span>
<span>            n_ages <span class="op">=</span> <span class="fl">8</span>, <span class="co">## number of age groups</span></span>
<span>            .toggles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fl">1</span>, time_ar <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">drm_2</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after</span></span>
<span>                                                  <span class="co">## warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This model introduces two additional parameters: <code>tau</code> (the conditional SD of the AR term), and <code>alpha</code> the temporal autocorrelation parameter.</p>
<p>Now, let us incorporate the fishing mortality into the model. We can load the Summer Flounder fishing mortality rates as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fmat</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"fmat.rds"</span>, package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">years_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NCOL</a></span><span class="op">(</span><span class="va">fmat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">years_train</span> <span class="op">&lt;-</span> <span class="va">years_all</span><span class="op">[</span><span class="va">years_all</span> <span class="op">&lt;</span> <span class="va">first_id_forecast</span><span class="op">]</span></span>
<span><span class="va">years_test</span>  <span class="op">&lt;-</span> <span class="va">years_all</span><span class="op">[</span><span class="va">years_all</span> <span class="op">&gt;=</span> <span class="va">first_id_forecast</span><span class="op">]</span></span>
<span></span>
<span><span class="va">f_train</span> <span class="op">&lt;-</span> <span class="va">fmat</span><span class="op">[</span>, <span class="va">years_train</span><span class="op">]</span></span>
<span><span class="va">f_test</span>  <span class="op">&lt;-</span> <span class="va">fmat</span><span class="op">[</span>, <span class="va">years_test</span><span class="op">]</span></span></code></pre></div>
</div>
<p>To fit a model taking this information into consideration, we just provide the <code>fmat</code> object to <code>make_data</code> and refit the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_data.html">make_data</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">dens</span>, <span class="co">## response variable: density</span></span>
<span>            time <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span>, <span class="co">## vector of time points</span></span>
<span>            site <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">patch</span>, <span class="co">## vector of patches</span></span>
<span>            f_mort <span class="op">=</span> <span class="va">f_train</span>,</span>
<span>            n_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">f_train</span><span class="op">)</span>, <span class="co">## number of age groups</span></span>
<span>            .toggles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fl">1</span>, time_ar <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">drm_3</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after</span></span>
<span>                                                  <span class="co">## warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>,   <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Now, let us introduce movement into the model. First, let us load the map of the patches to be able to calculate the adjacency matrix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐀</mi><annotation encoding="application/x-tex">\mathbf{A}</annotation></semantics></math> from <a href="https://pinskylab.github.io/drmr/articles/theory.html#sec-movement">the movement methodology</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"maps/sum_fl.shp"</span>, package <span class="op">=</span> <span class="st">"drmr"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">polygons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">map_name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">polygons</span>,</span>
<span>          color <span class="op">=</span> <span class="fl">1</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"gray70"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Finally, the code below calculates the auxiliary quantities for the movement matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adj_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_adj.html">gen_adj</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">polygons</span><span class="op">)</span>,</span>
<span>                             dist <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## row-standardized matrix</span></span>
<span><span class="va">adj_mat</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">adj_mat</span>, <span class="fl">1</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Below, we adjust the <code>make_data</code> function accordingly and fit the model with movement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_data.html">make_data</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">dens</span>, <span class="co">## response variable: density</span></span>
<span>            time <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span>, <span class="co">## vector of time points</span></span>
<span>            site <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">patch</span>, <span class="co">## vector of patches</span></span>
<span>            f_mort <span class="op">=</span> <span class="va">f_train</span>,</span>
<span>            n_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">f_train</span><span class="op">)</span>, <span class="co">## number of age groups</span></span>
<span>            adj_mat <span class="op">=</span> <span class="va">adj_mat</span>,</span>
<span>            age_at_maturity <span class="op">=</span> <span class="fl">3</span>, <span class="co">## age at which fish are able to move</span></span>
<span>            .toggles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fl">1</span>, <span class="co">## non-zero density pdf</span></span>
<span>                            time_ar <span class="op">=</span> <span class="fl">1</span>, <span class="co">## ar(1) for recruitment</span></span>
<span>                            movement <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">## turning movement on</span></span>
<span></span>
<span><span class="va">drm_4</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after</span></span>
<span>                                                  <span class="co">## warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>,   <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This model introduces the parameter <code>zeta</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ζ</mi><annotation encoding="application/x-tex">\zeta</annotation></semantics></math>) which represents the probability of <em>not moving</em> from time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math> to time <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t + 1</annotation></semantics></math>. The estimated probability of not moving is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.498</mn><annotation encoding="application/x-tex">0.498</annotation></semantics></math>.</p>
<p>We can make the model more complex/flexible by incorporating environmental drivers. We have two variables representing environmental drivers: sea bottom temperature (<code>btemp</code>) and sea surface temperature (<code>stemp</code>). They can be incorporated into the probability of observing zero density, recruitment, and/or survival (or mortality).</p>
<p>The relationship between recruitment (or survival) and environmental factors we can obtain are highlighted in <a href="#fig-rel" class="quarto-xref">Figure 1</a>. Before introducing these variables into the models, it is a good practice to center them at 0 to improve the MCMC efficiency. The code chunk below centers the covariates at 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">avgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stemp"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">stemp</span><span class="op">)</span>,</span>
<span>          <span class="st">"btemp"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">btemp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">min_year</span> <span class="op">&lt;-</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_train</span> <span class="op">&lt;-</span> <span class="va">dat_train</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stemp <span class="op">=</span> <span class="va">stemp</span> <span class="op">-</span> <span class="va">avgs</span><span class="op">[</span><span class="st">"stemp"</span><span class="op">]</span>,</span>
<span>         btemp <span class="op">=</span> <span class="va">btemp</span> <span class="op">-</span> <span class="va">avgs</span><span class="op">[</span><span class="st">"btemp"</span><span class="op">]</span>,</span>
<span>         time  <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">min_year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_test</span> <span class="op">&lt;-</span> <span class="va">dat_test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stemp <span class="op">=</span> <span class="va">stemp</span> <span class="op">-</span> <span class="va">avgs</span><span class="op">[</span><span class="st">"stemp"</span><span class="op">]</span>,</span>
<span>         btemp <span class="op">=</span> <span class="va">btemp</span> <span class="op">-</span> <span class="va">avgs</span><span class="op">[</span><span class="st">"btemp"</span><span class="op">]</span>,</span>
<span>         time  <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">min_year</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="fig-rel" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 33.3%;justify-content: flex-start;">
<p>Available relationship between recruitment/survival and environmental factors.</p>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1
</figcaption></figure>
</div>
<p>A quadratic relationship between recruitment and <code>stemp</code>, a log-linear relationship between survival and <code>btemp</code>, and a non-linear function between the log-odds of observing a zero density and those two variables can be obtained as in the code chunk below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##--- formulas (will be helpful for forecasting as well) ----</span></span>
<span></span>
<span><span class="co">## formula for the linear predictor of recruitmemt it defines a quadratic</span></span>
<span><span class="co">## relationship between recruitment and surface temperature</span></span>
<span><span class="va">form_r</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span></span>
<span>  <span class="va">stemp</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">stemp</span> <span class="op">*</span> <span class="va">stemp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## formula for the linear predictor in the survival rates</span></span>
<span><span class="va">form_m</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">btemp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">btemp</span> <span class="op">*</span> <span class="va">btemp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## formula for the linear predictor of observing a zero density</span></span>
<span><span class="va">form_t</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span></span>
<span>  <span class="va">btemp</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">btemp</span> <span class="op">*</span> <span class="va">btemp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">stemp</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">stemp</span> <span class="op">*</span> <span class="va">stemp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">btemp</span> <span class="op">*</span> <span class="va">stemp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##--- building "X matrices" ----</span></span>
<span></span>
<span><span class="va">x_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_m</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dat_train</span><span class="op">)</span></span>
<span><span class="va">x_r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_r</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dat_train</span><span class="op">)</span></span>
<span><span class="va">x_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_t</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dat_train</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Finally, the code below adjusts the data object for a model with movement, time-varying and env-dependent recruitment, env-dependent mortality, and env-dependent prob of observing a “0 density”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/make_data.html">make_data</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">dens</span>, <span class="co">## response variable: density</span></span>
<span>            time <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">year</span>, <span class="co">## vector of time points</span></span>
<span>            site <span class="op">=</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">patch</span>, <span class="co">## vector of patches</span></span>
<span>            f_mort <span class="op">=</span> <span class="va">f_train</span>,</span>
<span>            n_ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">f_train</span><span class="op">)</span>, <span class="co">## number of age groups</span></span>
<span>            x_t <span class="op">=</span> <span class="va">x_t</span>,</span>
<span>            x_r <span class="op">=</span> <span class="va">x_r</span>,</span>
<span>            x_m <span class="op">=</span> <span class="va">x_m</span>,</span>
<span>            adj_mat <span class="op">=</span> <span class="va">adj_mat</span>,</span>
<span>            age_at_maturity <span class="op">=</span> <span class="fl">3</span>, <span class="co">## age at which fish are able to move</span></span>
<span>            .toggles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>likelihood <span class="op">=</span> <span class="fl">1</span>, <span class="co">## non-zero density pdf</span></span>
<span>                            time_ar <span class="op">=</span> <span class="fl">1</span>, <span class="co">## ar(1) for recruitment</span></span>
<span>                            qr_t <span class="op">=</span> <span class="fl">1</span>, <span class="co">## QR parametrization for mortality coefs</span></span>
<span>                            est_mort <span class="op">=</span> <span class="fl">1</span>, <span class="co">## turn env dependent mortality on</span></span>
<span>                            movement <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co">## turning movement on</span></span>
<span>            .priors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pr_phi_a <span class="op">=</span> <span class="fl">9</span>, <span class="co">## hyperpar for phi prior (phi ~ Gamma(a, b))</span></span>
<span>                           pr_phi_b <span class="op">=</span> <span class="fl">.5</span>, <span class="co">## hyperpar for phi prior</span></span>
<span>                           pr_coef_r_mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_r</span><span class="op">)</span><span class="op">)</span>, <span class="co">## hyperpar for coef_r</span></span>
<span>                           pr_coef_r_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10000</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_r</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">## hyperpar for coef_r</span></span></code></pre></div>
</div>
<p>The code below fits the model associated to the data object above to the data and introduce another feature: using the pathfinder <span class="citation" data-cites="zhang2022pathfinder">(<a href="#ref-zhang2022pathfinder" role="doc-biblioref">Zhang et al. 2022</a>)</span> algorithm for obtaining the initial values for the MCMC algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## initial values for mcmc</span></span>
<span><span class="va">init_5</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">pathfinder</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                          seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                          num_paths <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          save_single_paths <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          psis_resample <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">drm_5</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after</span></span>
<span>                                                  <span class="co">## warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>,   <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             init <span class="op">=</span> <span class="va">init_5</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>We can also fit a Gamma (instead of log-normal) model to the data. It suffices to modify the <code>likelihood</code> toggle in the data object and rerun the code. See below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## modifying only "likelihood" toggle</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">likelihood</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co">## initial values for mcmc</span></span>
<span><span class="va">init_6</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">pathfinder</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                          seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                          num_paths <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          save_single_paths <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          psis_resample <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">drm_6</span> <span class="op">&lt;-</span> <span class="va">drm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                             iter_sampling <span class="op">=</span> <span class="fl">400</span>, <span class="co">## number of samples after</span></span>
<span>                                                  <span class="co">## warmup</span></span>
<span>                             iter_warmup <span class="op">=</span> <span class="fl">400</span>,   <span class="co">## number of warmup samples</span></span>
<span>                             seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                             chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                             init <span class="op">=</span> <span class="va">init_6</span>,</span>
<span>                             parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Lastly, let us fit a similar Gamma SDM to the data. The data object associated with the <code>sdm</code> model is similar, but some elements need to be renamed <a class="footnote-ref" role="doc-noteref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;I’m working on building a similar function to create the data for the SDM as well.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## copy the data object from the last model</span></span>
<span><span class="va">data_sdm</span> <span class="op">&lt;-</span> <span class="va">data</span></span>
<span></span>
<span><span class="co">## modify time (need to start at 1 for the SDM)</span></span>
<span><span class="va">data_sdm</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">dat_train</span><span class="op">$</span><span class="va">time</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">## renaming elements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"X_t"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Z"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"K_t"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"K_z"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"X_r"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"X"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"K_r"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"K_x"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"qr_r"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"qr_x"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">)</span> <span class="op">==</span> <span class="st">"qr_t"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"qr_z"</span></span>
<span></span>
<span><span class="va">init_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdm_compiled</span><span class="op">$</span><span class="fu">pathfinder</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sdm</span>,</span>
<span>                          seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                          num_paths <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                          save_single_paths <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                          psis_resample <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sdm_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdm_compiled</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sdm</span>,</span>
<span>                      iter_sampling <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                      iter_warmup <span class="op">=</span> <span class="fl">400</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                      chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                      parallel_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                      init <span class="op">=</span> <span class="va">init_sdm</span><span class="op">)</span></span></code></pre></div>
</div>
<p>To compare how well each of these models adjust to the data, we can look at their leave-one-out information criterion [LOOIC; <span class="citation" data-cites="vehtari2017practical">Vehtari, Gelman, and Gabry (<a href="#ref-vehtari2017practical" role="doc-biblioref">2017</a>)</span>]. According to this criteria, the best model (in terms of goodness-of-fit) was the most complex DRM with a Gamma pdf for the non-zero part of the zero-augmented model. The SDM appears as the third best model according to this criteria.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_loos</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"DRM 1"</span> <span class="op">=</span> <span class="va">drm_1</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"DRM 2"</span> <span class="op">=</span> <span class="va">drm_2</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"DRM 3"</span> <span class="op">=</span> <span class="va">drm_3</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"DRM 4"</span> <span class="op">=</span> <span class="va">drm_4</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"DRM 5"</span> <span class="op">=</span> <span class="va">drm_5</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"DRM 6"</span> <span class="op">=</span> <span class="va">drm_6</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       <span class="st">"SDM 1"</span> <span class="op">=</span> <span class="va">sdm_1</span><span class="op">$</span><span class="fu">loo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">loo</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/loo/reference/loo_compare.html" class="external-link">loo_compare</a></span><span class="op">(</span><span class="va">all_loos</span><span class="op">)</span></span></code></pre></div>
</div>
<p>According to the LOOIC criteria, the model without the AR(1) term has a better fit.</p>
</section><section class="level2"><h2 id="diagnosing-the-best-models">Diagnosing the best models<a class="anchor" aria-label="anchor" href="#diagnosing-the-best-models"></a>
</h2>
<p>In this Section, we will look into the convergence of the chains associated to some of the model parameters for the best DRM and SDM models.</p>
<section class="level3"><h3 id="drm">DRM<a class="anchor" aria-label="anchor" href="#drm"></a>
</h3>
<p><strong>?@fig-drm6_1</strong> depicts the traceplots (left) and overlay-ed (right) density plots for the parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math> and the two parameters (<code>sigma_r</code> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>) associated to the AR(1) random effect used to introduce temporal dependence to recruitment. In general, the chains seem to mix well and the estimated posterior densities associated to different chains are fairly similar, which is a good indication of convergence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"mix-red-blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">viz_pars</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau[1]"</span>,</span>
<span>    <span class="st">"alpha[1]"</span>,</span>
<span>    <span class="st">"phi[1]"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="va">viz_pars</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span>,</span>
<span>           facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>?@fig-drm6_2</strong> shows the traceplots (left) and overlay-ed (right) density plots for the regression coefficients associated with recruitment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"coef_r"</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>?@fig-drm6_3</strong> shows the traceplots (left) and overlay-ed (right) density plots for the regression coefficients associated with survival.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"coef_m"</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>?@fig-drm6_4</strong> shows the traceplots (left) and overlay-ed (right) density plots for the regression coefficients associated with the probability of absence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"coef_t"</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Despite the small number of posterior samples, the evidence for the graphs suggests the chains have converged.</p>
<p><strong>?@fig-drm6_pp</strong> displays a posterior predictive model assessment <span class="citation" data-cites="gabry2019visualization">(<a href="#ref-gabry2019visualization" role="doc-biblioref">Gabry et al. 2019</a>)</span> for the DRM. The darker blue density is estimated from the data directly, while the lighter blue densities are estimated from the posterior predictive distribution (they can be seen as posterior samples from “fitted” values). The similarity among the darker and lighter curves indicate appropriate fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_pp</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_pp"</span>,</span>
<span>              format <span class="op">=</span> <span class="st">"matrix"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                 <span class="va">y_pp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">y_pp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             size <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="sdm">SDM<a class="anchor" aria-label="anchor" href="#sdm"></a>
</h3>
<p><strong>?@fig-sdm_1</strong> depicts the traceplots (left) and overlay-ed (right) density plots for the parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math> and the two parameters (<code>sigma_r</code> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>) associated to the AR(1) random effect used to introduce temporal dependence to the density. In general, the chains seem to mix well and the estimated posterior densities associated to different chains are fairly similar, which is a good indication of convergence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">viz_pars</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tau[1]"</span>,</span>
<span>    <span class="st">"alpha[1]"</span>,</span>
<span>    <span class="st">"phi[1]"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="va">viz_pars</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span>,</span>
<span>           facet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>labeller <span class="op">=</span> <span class="va">label_parsed</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>?@fig-sdm_2</strong> shows the traceplots (left) and overlay-ed (right) density plots for the regression coefficients associated with the non-zero densities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"coef_r"</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p><strong>?@fig-drm6_4</strong> shows the traceplots (left) and overlay-ed (right) density plots for the regression coefficients associated with the probabilities of absence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-combos.html" class="external-link">mcmc_combo</a></span><span class="op">(</span><span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"coef_t"</span><span class="op">)</span>,</span>
<span>           combo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trace"</span>, <span class="st">"dens_overlay"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Despite the small number of posterior samples, the evidence for the graphs suggests the chains have converged.</p>
<p><strong>?@fig-sdm_pp</strong> displays a posterior predictive model assessment <span class="citation" data-cites="gabry2019visualization">(<a href="#ref-gabry2019visualization" role="doc-biblioref">Gabry et al. 2019</a>)</span> for the SDM. The darker blue density is estimated from the data directly, while the lighter blue densities are estimated from the posterior predictive distribution (they can be seen as posterior samples from “fitted” values). The similarity among the darker and lighter curves indicate appropriate fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_pp</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_pp"</span>,</span>
<span>              format <span class="op">=</span> <span class="st">"matrix"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/PPC-distributions.html" class="external-link">ppc_dens_overlay</a></span><span class="op">(</span><span class="va">data_sdm</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                 <span class="va">y_pp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">y_pp</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             size <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="forecasting">Forecasting<a class="anchor" aria-label="anchor" href="#forecasting"></a>
</h3>
<p>The code below computes the forecasts for the best DRM and SDM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_t</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">dat_test</span><span class="op">)</span></span>
<span><span class="va">x_mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_m</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">dat_test</span><span class="op">)</span></span>
<span><span class="va">x_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_r</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">dat_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_mpast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">form_m</span>,</span>
<span>               data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dat_train</span>, <span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forecast_drm_6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_drm.html">predict_drm</a></span><span class="op">(</span>drm <span class="op">=</span> <span class="va">drm_6</span>,</span>
<span>                              drm_data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                              ntime_for <span class="op">=</span></span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat_test</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                              x_tt <span class="op">=</span> <span class="va">x_tt</span>,</span>
<span>                              x_rt <span class="op">=</span> <span class="va">x_rt</span>,</span>
<span>                              x_mt <span class="op">=</span> <span class="va">x_mt</span>,</span>
<span>                              x_mpast <span class="op">=</span> <span class="va">x_mpast</span>,</span>
<span>                              f_test <span class="op">=</span> <span class="va">f_test</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                              seed <span class="op">=</span> <span class="fl">125</span>,</span>
<span>                              cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">##--- * SDM ----</span></span>
<span></span>
<span><span class="va">fitted_params</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"coef_t"</span>, <span class="st">"coef_r"</span>,</span>
<span>                            <span class="st">"z_t"</span>,</span>
<span>                            <span class="st">"alpha"</span>, <span class="st">"tau"</span>,</span>
<span>                            <span class="st">"phi"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forecast_data2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n_patches <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">n_patches</span>,</span>
<span>       n_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dat_test</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       time <span class="op">=</span> <span class="va">dat_test</span><span class="op">$</span><span class="va">time</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">dat_test</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>       n_ages <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       n_time_train <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">n_time</span>,</span>
<span>       time_ar <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">time_ar</span>,</span>
<span>       cloglog <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">cloglog</span>,</span>
<span>       likelihood <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">likelihood</span>,</span>
<span>       K_z <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">K_z</span>,</span>
<span>       Z <span class="op">=</span> <span class="va">x_tt</span>,</span>
<span>       K_x <span class="op">=</span> <span class="va">data_sdm</span><span class="op">$</span><span class="va">K_x</span>,</span>
<span>       X <span class="op">=</span> <span class="va">x_rt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">forecast_data2</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">forecast_data2</span><span class="op">$</span><span class="va">n_patches</span> <span class="op">*</span> <span class="va">forecast_data2</span><span class="op">$</span><span class="va">n_time</span></span>
<span></span>
<span><span class="va">forecast_sdm_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">forecast_sdm</span><span class="op">$</span></span>
<span>  <span class="fu">generate_quantities</span><span class="op">(</span>fitted_params <span class="op">=</span> <span class="va">fitted_params</span>,</span>
<span>                      data <span class="op">=</span> <span class="va">forecast_data2</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fl">125</span>,</span>
<span>                      parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="forecast-mu_t-i">Forecast <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{t, i}</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#forecast-mu_t-i"></a>
</h3>
<p><strong>?@fig-forecast_mu</strong> displays the forecasted expected densities conditioned on encountering (i.e., <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y_{t, i} &gt; 0</annotation></semantics></math>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mu_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">forecast_drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"mu_proj"</span>,</span>
<span>                     format <span class="op">=</span> <span class="st">"draws_df"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mu_proj"</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"pair"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"expected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>,</span>
<span>            m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,</span>
<span>            u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>,</span>
<span>            uu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">lat_floor</span>, <span class="va">patch</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">mu_drm</span>, by <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"DRM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">forecast_sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"mu_proj"</span>,</span>
<span>                     format <span class="op">=</span> <span class="st">"draws_df"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"mu_proj"</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"pair"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"expected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>,</span>
<span>            m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,</span>
<span>            u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>,</span>
<span>            uu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">lat_floor</span>, <span class="va">patch</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">mu_sdm</span>, by <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"SDM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">mu_drm</span>, <span class="va">mu_sdm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_color</span> <span class="op">&lt;-</span> <span class="st">"#0465cf"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mu_proj</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">uu</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">l</span>, ymax <span class="op">=</span> <span class="va">u</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">model</span> <span class="op">~</span> <span class="va">patch</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="forecast-y_t-i">Forecast <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">Y_{t, i}</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#forecast-y_t-i"></a>
</h3>
<p><strong>?@fig-forecast_y</strong> displayes the forecasts for the response variable through its posterior predictive distribution. That is, unlike <strong>?@fig-forecast_mu</strong>, it accounts for the zero-augmentation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">forecast_drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_proj"</span>,</span>
<span>                       format <span class="op">=</span> <span class="st">"draws_df"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"y_proj"</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"pair"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"expected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>,</span>
<span>            m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,</span>
<span>            u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>,</span>
<span>            uu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">lat_floor</span>, <span class="va">patch</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">y_drm</span>, by <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"DRM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">forecast_sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_proj"</span>,</span>
<span>                       format <span class="op">=</span> <span class="st">"draws_df"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"y_proj"</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"pair"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"expected"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>ll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span>,</span>
<span>            l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>,</span>
<span>            m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">expected</span><span class="op">)</span>,</span>
<span>            u <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.9</span><span class="op">)</span>,</span>
<span>            uu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">expected</span>, probs <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">pair</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dat_test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">lat_floor</span>, <span class="va">patch</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pair <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">y_sdm</span>, by <span class="op">=</span> <span class="st">"pair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"SDM"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y_proj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">y_drm</span>, <span class="va">y_sdm</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y_proj</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">patch</span>,</span>
<span>             fill <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_color</span> <span class="op">&lt;-</span> <span class="st">"#0465cf"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">y_proj</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">uu</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">l</span>, ymax <span class="op">=</span> <span class="va">u</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">dens</span><span class="op">)</span>,</span>
<span>             inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">patch</span> <span class="op">~</span> <span class="va">model</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">model</span> <span class="op">~</span> <span class="va">patch</span>,</span>
<span>             scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span></code></pre></div>
</div>
<p><a href="#tbl-assessment" class="quarto-xref">Table 1</a> suggests the DRM delivers more reliable forecasts. However, the coverage of the prediction intervals (PIC) are above the nominal level for the DRM, while the ones from the SDM are below the nominal level.</p>
<div id="tbl-assessment" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-assessment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1: Forecasting assessment.
</figcaption><div aria-describedby="tbl-assessment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="tbl-assessment"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y_proj</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>bias <span class="op">=</span> <span class="va">dens</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rmse <span class="op">=</span> <span class="va">bias</span> <span class="op">*</span> <span class="va">bias</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>abias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">bias</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is1 <span class="op">=</span> <span class="fu"><a href="../reference/int_score.html">int_score</a></span><span class="op">(</span><span class="va">dens</span>, l <span class="op">=</span> <span class="va">ll</span>, u <span class="op">=</span> <span class="va">uu</span>, alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>is2 <span class="op">=</span> <span class="fu"><a href="../reference/int_score.html">int_score</a></span><span class="op">(</span><span class="va">dens</span>, l <span class="op">=</span> <span class="va">l</span>, u <span class="op">=</span> <span class="va">u</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cvg1 <span class="op">=</span> <span class="fu"><a href="../reference/between.html">between</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">ll</span>, <span class="va">uu</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cvg2 <span class="op">=</span> <span class="fu"><a href="../reference/between.html">between</a></span><span class="op">(</span><span class="va">dens</span>, <span class="va">l</span>, <span class="va">u</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">bias</span><span class="op">:</span><span class="va">cvg2</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_all</a></span><span class="op">(</span><span class="va">toupper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"Model"</span> <span class="op">=</span> <span class="st">"MODEL"</span>,</span>
<span>         <span class="st">"IS (90%)"</span> <span class="op">=</span> <span class="st">"IS1"</span>,</span>
<span>         <span class="st">"IS (80%)"</span> <span class="op">=</span> <span class="st">"IS2"</span>,</span>
<span>         <span class="st">"PIC (90%)"</span> <span class="op">=</span> <span class="st">"CVG1"</span>,</span>
<span>         <span class="st">"PIC (80%)"</span> <span class="op">=</span> <span class="st">"CVG2"</span><span class="op">)</span></span></code></pre></div>
</div>
</figure>
</div>
</section><section class="level3"><h3 id="centroids">Centroids<a class="anchor" aria-label="anchor" href="#centroids"></a>
</h3>
<p><strong>?@fig-centroids</strong> depicts the centroids estimated by the DRM and SDM on the left and right-side of the panel, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centroid_drm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">centroids_compiled</span><span class="op">$</span></span>
<span>  <span class="fu">generate_quantities</span><span class="op">(</span>fitted_params <span class="op">=</span></span>
<span>                        <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/bind_draws.html" class="external-link">bind_draws</a></span><span class="op">(</span></span>
<span>                                       <span class="va">drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_pp"</span><span class="op">)</span>,</span>
<span>                                       <span class="va">forecast_drm_6</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_proj"</span><span class="op">)</span></span>
<span>                                       <span class="op">)</span>,</span>
<span>                      data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                          N1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">)</span>,</span>
<span>                          N2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_test</span><span class="op">)</span>,</span>
<span>                          n_c <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          coords <span class="op">=</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">lat_floor</span>,</span>
<span>                                     <span class="va">dat_test</span><span class="op">$</span><span class="va">lat_floor</span><span class="op">)</span>,</span>
<span>                                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                          n_t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                                                <span class="va">dat_test</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="op">)</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                      parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">centroid_sdm</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">centroids_compiled</span><span class="op">$</span></span>
<span>  <span class="fu">generate_quantities</span><span class="op">(</span>fitted_params <span class="op">=</span></span>
<span>                        <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/bind_draws.html" class="external-link">bind_draws</a></span><span class="op">(</span></span>
<span>                                       <span class="va">sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_pp"</span><span class="op">)</span>,</span>
<span>                                       <span class="va">forecast_sdm_1</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"y_proj"</span><span class="op">)</span></span>
<span>                                       <span class="op">)</span>,</span>
<span>                      data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                          N1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">)</span>,</span>
<span>                          N2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat_test</span><span class="op">)</span>,</span>
<span>                          n_c <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                          coords <span class="op">=</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">lat_floor</span>,</span>
<span>                                     <span class="va">dat_test</span><span class="op">$</span><span class="va">lat_floor</span><span class="op">)</span>,</span>
<span>                                   ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                          n_t <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dat_train</span><span class="op">$</span><span class="va">time</span>,</span>
<span>                                                <span class="va">dat_test</span><span class="op">$</span><span class="va">time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="op">)</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fl">2025</span>,</span>
<span>                      parallel_chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">centroid_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>      <span class="va">centroid_drm</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_intervals_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[[:digit:][:punct:]]"</span>, <span class="st">""</span>, <span class="va">parameter</span><span class="op">)</span>,</span>
<span>             .before <span class="op">=</span> <span class="va">parameter</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span> <span class="op">+</span> <span class="va">min_year</span>,</span>
<span>             .before <span class="op">=</span> <span class="va">parameter</span>,</span>
<span>             model <span class="op">=</span> <span class="st">"DRM"</span><span class="op">)</span>,</span>
<span>      <span class="va">centroid_sdm</span><span class="op">$</span><span class="fu">draws</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_intervals_data</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[[:digit:][:punct:]]"</span>, <span class="st">""</span>, <span class="va">parameter</span><span class="op">)</span>,</span>
<span>             .before <span class="op">=</span> <span class="va">parameter</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                                <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span> <span class="op">+</span> <span class="va">min_year</span>,</span>
<span>             .before <span class="op">=</span> <span class="va">parameter</span>,</span>
<span>             model <span class="op">=</span> <span class="st">"SDM"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">centroid_all</span>,</span>
<span>                     <span class="va">type</span> <span class="op">==</span> <span class="st">"centroid"</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>,</span>
<span>             y <span class="op">=</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">ll</span>, ymax <span class="op">=</span> <span class="va">hh</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">l</span>, ymax <span class="op">=</span> <span class="va">h</span><span class="op">)</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">my_color</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">first_year_forecast</span>,</span>
<span>             col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>,</span>
<span>             lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">model</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</section></section><section class="level2 unnumbered"><h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-gabry2024cmdstanr" class="csl-entry" role="listitem">
Gabry, Jonah, Rok Çešnovar, Andrew Johnson, and Steve Bronder. 2024. <em>Cmdstanr: R Interface to <span>CmdStan</span></em>. <a href="https://github.com/stan-dev/cmdstanr" class="external-link">https://github.com/stan-dev/cmdstanr</a>.
</div>
<div id="ref-gabry2019visualization" class="csl-entry" role="listitem">
Gabry, Jonah, Daniel Simpson, Aki Vehtari, Michael Betancourt, and Andrew Gelman. 2019. <span>“Visualization in Bayesian Workflow.”</span> <em>Journal of the Royal Statistical Society: Series A (Statistics in Society)</em> 182 (2): 389–402. https://doi.org/<a href="https://doi.org/10.1111/rssa.12378" class="external-link">https://doi.org/10.1111/rssa.12378</a>.
</div>
<div id="ref-landau2024instantiate" class="csl-entry" role="listitem">
Landau, William Michael. 2024. <em>Instantiate: Pre-Compiled <span>CmdStan</span> Models in <span>R</span> Packages</em>. <a href="https://CRAN.R-project.org/package=instantiate" class="external-link">https://CRAN.R-project.org/package=instantiate</a>.
</div>
<div id="ref-vehtari2017practical" class="csl-entry" role="listitem">
Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. <span>“Practical Bayesian Model Evaluation Using Leave-One-Out Cross-Validation and WAIC.”</span> <em>Statistics and Computing</em> 27: 1413–32.
</div>
<div id="ref-ye2021comparisons" class="csl-entry" role="listitem">
Ye, Tairan, Victor H Lachos, Xiaojing Wang, and Dipak K Dey. 2021. <span>“Comparisons of Zero-Augmented Continuous Regression Models from a <span>B</span>ayesian Perspective.”</span> <em>Statistics in Medicine</em> 40 (5): 1073–1100.
</div>
<div id="ref-zhang2022pathfinder" class="csl-entry" role="listitem">
Zhang, Lu, Bob Carpenter, Andrew Gelman, and Aki Vehtari. 2022. <span>“Pathfinder: Parallel Quasi-Newton Variational Inference.”</span> <em>Journal of Machine Learning Research</em> 23 (306): 1–49. <a href="http://jmlr.org/papers/v23/21-0889.html" class="external-link">http://jmlr.org/papers/v23/21-0889.html</a>.
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'light-border',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lucas da Cunha Godoy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
